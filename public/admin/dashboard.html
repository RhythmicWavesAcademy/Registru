		<!DOCTYPE html>
		<html>
		<head>
			<meta charset="utf-8">
			<meta name="viewport" content="width=device-width, initial-scale=1">
			<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
			<title>Admin Dashboard</title>
		</head>
		<body>
			<h1> Welcome admin </h1>

			<h2 id="test"> Add parent </h2>
			<form id="parent_form" action="javascript:void(0);" method="post">
				<div class="form-group">
					<label>First Name</label>
					<input type="text" id="parent_first_name"></br>
					<label>Last Name</label>
					<input type="text" id="parent_last_name"></br>

					<input type="submit" value="Add parent" id="submit_parent">
				</div>
			</form>  

			<h2 id="children_title"> Add children </h2>
			<form id="children_form" action="javascript:void(0);" method="post">
				<div class="form-group">
					<label>First Name</label>
					<input type="text" id="children_first_name"></br>

					<label>Last Name</label>
					<input type="text" id="children_last_name"></br>

					<label>Gender</label>
					<select name="children_gender" id="children_gender">
						<option value="male">Male</option>
						<option value="female">Female</option>
					</select><br />

					<label>Age</label>
					<input type="number" id="children_age" name="children_age" min="1" max="99"><br />

					<div id="class_activities_form_container"></div>

					<input type="submit" value="Add children" id="submit_children">
				</div>
			</form>  

			<h2 id="trainer_title"> Add trainer </h2>
			<form id="trainer_form" action="javascript:void(0);" method="post">
				<div class="form-group">
					<label>First Name</label>
					<input type="text" id="trainer_first_name"></br>
					<label>Last Name</label>
					<input type="text" id="trainer_last_name"></br>

					<input type="submit" value="Add trainer" id="submit_trainer">
				</div>
			</form>  

			<h2 id="class_activity_title"> Add class activity </h2>
			<form id="class_activity_form" action="javascript:void(0);" method="post">
				<div class="form-group">
					<label>Name</label>
					<input type="text" id="class_activity_name"></br>
					<label>Attendance day </label></br>

					<input type="checkbox" id="class_activity_attendance_day_monday" name="class_activity_attendance_day" value="Monday">
					<label for="class_activity_attendance_day_monday">Monday</label>
					<label for="class_activity_attendance_time_monday">Time:</label>
					<input	id="class_activity_attendance_time_monday" type="time" name="class_activity_attendance_time" min="07:00" max="21:00" />
					<select name="activity_trainer" id="activity_trainer_monday"></select></br />

					<input type="checkbox" id="class_activity_attendance_day_tuesday" name="class_activity_attendance_day" value="Tuesday">
					<label for="class_activity_attendance_day_tuesday">Tuesday</label>
					<label for="class_activity_attendance_time_tuesday">Time:</label>
					<input	id="class_activity_attendance_time_tuesday" type="time" name="class_activity_attendance_time" min="07:00" max="21:00" />
					<select name="activity_trainer" id="activity_trainer_tuesday"></select></br />

					<input type="checkbox" id="class_activity_attendance_day_wednesday" name="class_activity_attendance_day" value="Wednesday">
					<label for="class_activity_attendance_day_wednesday">Wednesday</label>
					<label for="class_activity_attendance_time_wednesday">Time:</label>
					<input	id="class_activity_attendance_time_wednesday" type="time" name="class_activity_attendance_time" min="07:00" max="21:00" />
					<select name="activity_trainer" id="activity_trainer_wednesday"></select></br />

					<input type="checkbox" id="class_activity_attendance_day_thursday" name="class_activity_attendance_day" value="Thursday">
					<label for="class_activity_attendance_day_thursday">Thursday</label>
					<label for="class_activity_attendance_time_thursday">Time:</label>
					<input	id="class_activity_attendance_time_thursday" type="time" name="class_activity_attendance_time" min="07:00" max="21:00" />
					<select name="activity_trainer" id="activity_trainer_thursday"></select></br />

					<input type="checkbox" id="class_activity_attendance_day_friday" name="class_activity_attendance_day" value="Friday">
					<label for="class_activity_attendance_day_friday">Friday</label>
					<label for="class_activity_attendance_time_friday">Time:</label>
					<input	id="class_activity_attendance_time_friday" type="time" name="class_activity_attendance_time" min="07:00" max="21:00" />
					<select name="activity_trainer" id="activity_trainer_friday"></select></br />

					<input type="checkbox" id="class_activity_attendance_day_saturday" name="class_activity_attendance_day" value="Saturday">
					<label for="class_activity_attendance_day_saturday">Saturday</label>
					<label for="class_activity_attendance_time_saturday">Time:</label>
					<input	id="class_activity_attendance_time_saturday" type="time" name="class_activity_attendance_time" min="07:00" max="21:00" />
					<select name="activity_trainer" id="activity_trainer_saturday"></select></br />

					<input type="checkbox" id="class_activity_attendance_day_sunday" name="class_activity_attendance_day" value="Sunday">
					<label for="class_activity_attendance_day_sunday">Sunday</label>
					<label for="class_activity_attendance_time_sunday">Time:</label>
					<input	id="class_activity_attendance_time_sunday" type="time" name="class_activity_attendance_time" min="07:00" max="21:00" />
					<select name="activity_trainer" id="activity_trainer_sunday"></select></br />

					<input type="submit" value="Add class activity" id="submit_class_activity">
				</div>
			</form>  

			<h2 id="class_attendance_title"> Add class attendance </h2>
			<form id="trainer_form" action="javascript:void(0);" method="post">
				<div class="form-group">
					<label>Children Name</label>
					<select name="children_attendance_children_id" id="children_attendance_children_id"></select><br />
					<label>Class activity</label>
					<select name="children_attendance_class_activity" id="children_attendance_class_activity"></select><br />
					<label for="children_attendance_present">Is present?</label>
					<input type="radio" id="children_attendance_present" name="children_attendance_present" value="true"><br />
					<label for="children_attendance_datetime">Attendance date</label>
					<input type="datetime-local" id="children_attendance_datetime" name="children_attendance_datetime"><br />
					
					<input type="submit" value="Add class attendance" id="submit_class_attendance">
				</div>
			</form>  

			<h2> Children </h2>
			<div id="children"></div>

			<h2> Parents </h2>
			<div id="parents"></div>

			<h2> Trainers </h2>
			<div id="trainers"></div>

			<h2> Class activities </h2>
			<div id="class_activities"></div>

			<h2 id="attendances_list_title"> Attendances </h2>
			<div id="class_attendances"></div>

			<script type="module">
				//todo -- add children to parent when inserting - remove hardcoded id
				// update / delete entries
				
				import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-app.js";
				import { getFirestore } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-firestore.js";
				import { collection, getDocs, doc, getDoc, query, where, addDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-firestore.js"; 

				window.onload = async() => { 
		  // TODO: Add SDKs for Firebase products that you want to use
		  // https://firebase.google.com/docs/web/setup#available-libraries

					const firebaseConfig = {
						apiKey: "AIzaSyDAeTuoOcsllzvcsgNndgiOJbmfA_m7Aw4",
						authDomain: "rafaregistru.firebaseapp.com",
						projectId: "rafaregistru",
						storageBucket: "rafaregistru.firebasestorage.app",
						messagingSenderId: "85158895308",
						appId: "1:85158895308:web:d8667a0f769bef596a2c69"
					};


		  // Initialize Firebase
					const app = initializeApp(firebaseConfig);
					const db = getFirestore(app);

					const querySnapshotChildren = await getDocs(collection(db, "children"));

					for(let childrenDocument of querySnapshotChildren.docs) {
						var childrenElement = document.getElementById("children");
						var data = childrenDocument.data();
						const trainerDocument = await getDoc(doc(db, "trainers", data.trainer_id));
						var trainerData = trainerDocument.data();

						childrenElement.insertAdjacentHTML( 'beforeend', childrenDocument.id + "<br/>");
						childrenElement.insertAdjacentHTML( 'beforeend', "name:" + data.first_name + " " + data.last_name + "<br/>" );
						childrenElement.insertAdjacentHTML( 'beforeend', "age:" + data.age + "<br/>" );
						childrenElement.insertAdjacentHTML( 'beforeend', "gender:" + data.gender + "<br/>");
						childrenElement.insertAdjacentHTML( 'beforeend', "trainerId:" + data.trainer_id  + " name:" + trainerData.first_name +  " " + trainerData.last_name + "<br/>");


						childrenElement.insertAdjacentHTML( 'beforeend', "---------------------- </br>");
					};


					const querySnapshotParents = await getDocs(collection(db, "parents"));
					for(let parentDocument of querySnapshotParents.docs) {
						var parentElement = document.getElementById("parents");
						var data = parentDocument.data();
						const childrenDocument = data.children[0];
					// document.getElementById("parents_children").innerHTML = doc.id;
						parentElement.insertAdjacentHTML( 'beforeend', parentDocument.id + "<br/>");
						parentElement.insertAdjacentHTML( 'beforeend', "name:" + data.first_name + " " + data.last_name + "<br/>" );
						parentElement.insertAdjacentHTML( 'beforeend', "childrenId:" + childrenDocument  + "<br/>");


						parentElement.insertAdjacentHTML( 'beforeend', "---------------------- <br/>");
					};


					const querySnapshotTrainers = await getDocs(collection(db, "trainers"));
					for(let trainerDocument of querySnapshotTrainers.docs) {
						var trainerElement = document.getElementById("trainers");
						var data = trainerDocument.data();

						trainerElement.insertAdjacentHTML( 'beforeend', trainerDocument.id + "<br/>");
						trainerElement.insertAdjacentHTML( 'beforeend', "name:" + data.first_name + " " + data.last_name + "<br/>" );
						trainerElement.insertAdjacentHTML( 'beforeend', "---------------------- <br/>");
					};

					const querySnapshotClassActivity = await getDocs(collection(db, "class_activity"));
					for(let classActivityDocument of querySnapshotClassActivity.docs) {
						var classActivityElement = document.getElementById("class_activities");
						var data = classActivityDocument.data();

						classActivityElement.insertAdjacentHTML( 'beforeend', classActivityDocument.id + "<br/>");
						classActivityElement.insertAdjacentHTML( 'beforeend', "name:" + data.name + "<br/>" );

						var schedule = data.schedule;

						for (let activity of schedule) {
							const trainerDocument = await getDoc(doc(db, "trainers", activity.trainer_id));
							var trainerData = trainerDocument.data();

							classActivityElement.insertAdjacentHTML( 'beforeend', "trainerId:" + activity.trainer_id  + " name:" + trainerData.first_name +  " " + trainerData.last_name + "<br/>");
							classActivityElement.insertAdjacentHTML( 'beforeend', "day:" + activity.day + "<br/>");
							classActivityElement.insertAdjacentHTML( 'beforeend', "time:" + activity.time + "<br/>");
							
						}

						classActivityElement.insertAdjacentHTML( 'beforeend', "---------------------- <br/>");
					};

					const querySnapshotClassAttendance = await getDocs(collection(db, "attendance"));

					for(let classAttendanceDocument of querySnapshotClassAttendance.docs) {
						var classAttendanceElement = document.getElementById("class_attendances");
						var data = classAttendanceDocument.data();
						const childrenDocument = await getDoc(doc(db, "children", data.children_id));
						var childrenData = childrenDocument.data();

						const classActivityDocument = await getDoc(doc(db, "class_activity", data.class_activity_id));
						var classActivityData = classActivityDocument.data();

						classAttendanceElement.insertAdjacentHTML( 'beforeend', classAttendanceDocument.id + "<br/>");
						classAttendanceElement.insertAdjacentHTML( 'beforeend', "date:" + data.date + "<br/>" );
						classAttendanceElement.insertAdjacentHTML( 'beforeend', "isPresent?:" + data.is_present + "<br/>" );
						classAttendanceElement.insertAdjacentHTML( 'beforeend', "chlidrenId:" + data.children_id  + " name:" + childrenData.first_name +  " " + childrenData.last_name + "<br/>");
						classAttendanceElement.insertAdjacentHTML( 'beforeend', "classActivityId:" + data.class_activity_id  + " name:" + classActivityData.name + "<br/>");

						classAttendanceElement.insertAdjacentHTML( 'beforeend', '<span id=' + classAttendanceDocument.id + ' class="material-icons">home</span>' + "<br/>");

						var classAttendanceSpan = document.getElementById(classAttendanceDocument.id);
						classAttendanceSpan.addEventListener("click", deleteClassAttendance, false);
						classAttendanceSpan.attendanceId = classAttendanceDocument.id;

						classAttendanceElement.insertAdjacentHTML( 'beforeend', "---------------------- </br>");
					};

					document.getElementById("submit_parent").addEventListener("click", addParent, false);

					async function addParent() {
						const firstNameInput = document.querySelector("#parent_first_name");
						const lastNameInput = document.querySelector("#parent_last_name");

						const docRef = await addDoc(collection(db, "parents"), {
							children: ["W6fI4gTbBJl0YAxeY8di"],
							first_name: firstNameInput.value,
							last_name: lastNameInput.value
						});

						document.getElementById("test").innerHTML = "Added parent with id=" + docRef.id
						firstNameInput.value = "";
						lastNameInput.value = "";
					}


					document.getElementById("submit_trainer").addEventListener("click", addTrainer, false);

					async function addTrainer() {
						const firstNameInput = document.querySelector("#trainer_first_name");
						const lastNameInput = document.querySelector("#trainer_last_name");

						const docRef = await addDoc(collection(db, "trainers"), {
							first_name: firstNameInput.value,
							last_name: lastNameInput.value
						});

						document.getElementById("trainer_title").innerHTML = "Added trainer with id=" + docRef.id
						firstNameInput.value = "";
						lastNameInput.value = "";
					}

					document.getElementById("submit_children").addEventListener("click", addChildren, false);

					async function addChildren() {
						const firstNameInput = document.querySelector("#children_first_name");
						const lastNameInput = document.querySelector("#children_last_name");
						const genderInput =  document.querySelector("#children_gender");
						const ageInput =  document.querySelector("#children_age"); 

						var classActivityCheckboxes = document.querySelectorAll('input[name=children_class_activity]:checked');
						const checkedClassActivities = [];
						for (let checkbox of classActivityCheckboxes) {
							if (checkbox.checked) {
								checkedClassActivities.push(checkbox.value);
							}
						}

						const docRef = await addDoc(collection(db, "children"), {
							first_name: firstNameInput.value,
							last_name: lastNameInput.value,
							gender: genderInput.value,
							age: ageInput.value,
							class_activities_id : checkedClassActivities
						});

						document.getElementById("children_title").innerHTML = "Added children with id=" + docRef.id
						firstNameInput.value = "";
						lastNameInput.value = "";
						genderInput.value = "male";
						ageInput.value = "";
						for (let checkbox of classActivityCheckboxes) {
							checkbox.checked = false;
						}
					}

					document.getElementById("submit_class_activity").addEventListener("click", addClassActivity, false);

					async function addClassActivity() {
						const nameInput = document.querySelector("#class_activity_name");
						var attendanceCheckboxes = document.querySelectorAll('input[name=class_activity_attendance_day]');
						var attendanceTimes = document.querySelectorAll('input[name=class_activity_attendance_time]');
						var attendanceTrainers = document.getElementsByName("activity_trainer");

						const checkedScheduleDays = [];
						for (let i = 0; i < attendanceTimes.length; i++) {
							if (attendanceCheckboxes[i].checked) {
								var temp = {};
								temp["day"] =attendanceCheckboxes[i].value;
								temp["time"] = attendanceTimes[i].value;
								temp["trainer_id"] = attendanceTrainers[i].value;
								checkedScheduleDays.push(temp);

							}
						}

						const docRef = await addDoc(collection(db, "class_activity"), {
							name: nameInput.value,
							schedule : checkedScheduleDays
						});

						document.getElementById("class_activity_title").innerHTML = "Added class activity with id=" + docRef.id
						nameInput.value = "";
						for (let checkbox of attendanceCheckboxes) {
							checkbox.checked = false;
						}
						for (let time of attendanceTimes) {
							time.value = "";
						}
						for (let trainer of attendanceTrainers) {
							trainer.value = "";
						}
					}


					var classActivitiesFormContainer = document.getElementById("class_activities_form_container");
					for(let classActivitiesDocument of querySnapshotClassActivity.docs) {
						var data = classActivitiesDocument.data();

						classActivitiesFormContainer.insertAdjacentHTML( 'beforeend', '<input type="checkbox" id=' + classActivitiesDocument.id + ' name="children_class_activity" value=' + classActivitiesDocument.id + '>');
						classActivitiesFormContainer.insertAdjacentHTML( 'beforeend', '<label for=' + classActivitiesDocument.id + '>' + data.name + '</label><br>');
					};


					//populate class activity trainer section
					var trainerElementActivities = document.getElementsByName("activity_trainer");

					for (let i = 0; i < trainerElementActivities.length; i++) {
						for(let trainerDocument2 of querySnapshotTrainers.docs) {
							var data = trainerDocument2.data();

							var option = document.createElement("option");
							option.text = data.first_name + " " + data.last_name;
							option.value = trainerDocument2.id;
							trainerElementActivities[i].add(option);
						};
					}

					function toLocalISOString(date) {
						const localDate = new Date(date - date.getTimezoneOffset() * 60000);
						localDate.setSeconds(null);
						localDate.setMilliseconds(null);
						return localDate.toISOString().slice(0, -1);
					}

					document.getElementById('children_attendance_datetime').value = toLocalISOString(new Date());

					//populate class attendance with children and class activities
					var attendanceChildrenId = document.getElementById("children_attendance_children_id");
					for(let childrenDocument of querySnapshotChildren.docs) {
						var data = childrenDocument.data();

						attendanceChildrenId.insertAdjacentHTML( 'beforeend', '<option value=' + childrenDocument.id + '>' + data.first_name + " " + data.last_name + '</option>');
					};

					var attendanceClassActivity = document.getElementById("children_attendance_class_activity");
					for(let classActivityDocument of querySnapshotClassActivity.docs) {
						var data = classActivityDocument.data();

						attendanceClassActivity.insertAdjacentHTML( 'beforeend', '<option value=' + classActivityDocument.id + '>' + data.name + '</option>');
					};

					document.getElementById("submit_class_attendance").addEventListener("click", addClassAttendance, false);

					async function addClassAttendance() {
						const childrenId = document.querySelector("#children_attendance_children_id");
						const attendanceId = document.querySelector("#children_attendance_class_activity");
						const isPresent =  document.querySelector("#children_attendance_present");
						const dateTimeInput =  document.querySelector("#children_attendance_datetime"); 

						const docRef = await addDoc(collection(db, "attendance"), {
							children_id: childrenId.value,
							class_activity_id: attendanceId.value,
							is_present: isPresent.checked,
							date: dateTimeInput.value,
						});

						document.getElementById("class_attendance_title").innerHTML = "Added class attendance with id=" + docRef.id
						childrenId.value = "";
						attendanceId.value = "";
						isPresent.checked = false;
						dateTimeInput.value = toLocalISOString(new Date());
					}

					async function deleteClassAttendance(evt) {
						var attendanceId = evt.currentTarget.attendanceId;
						console.log("got attendanceId + " + evt.currentTarget.attendanceId);
						await deleteDoc(doc(db, "attendance", attendanceId));
						document.getElementById("attendances_list_title").innerHTML = "Removed class attendance with id=" + attendanceId;

					}
				}

			</script>
		</body>
		</html>